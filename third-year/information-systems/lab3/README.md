# Лабораторная работа №3

Доработать ИС из ЛР2 следующим образом:

- Осуществить подключение к базе данных через Connection Pool:
    - использовать Druid
    - в отчете к лабораторной работе описать параметры конфигурации, которые использовались для настройки пула соединений
- Добавить L2 JPA Cache:
    - в качестве реализации использовать Ehcache
    - реализовать в приложении возможность включения/отключения логирования статистики об использовании L2 JPA Cache (cache hits, cache misses). Если ваша лабораторная работа основана на Spring - для осуществления данной возможности использовать AOP; если приложение на Jakarta EE - использовать CDI Interceptors
    - в отчете к лабораторной работе описать параметры конфигурации, которые вы использовали для настройки L2-кэша и как они влияют на уровень хранения
- Реализовать сохранение загруженных на сервер файлов, используемых для импорта данных, в файловом хранилище MinIO (можно взять любое другое S3-совместимое хранилище). Поднять и настроить MinIO требуется самостоятельно. Загруженные файлы должны быть доступны для скачивания из таблицы с логом импорта.
- Сохранение загруженных файлов в файловом хранилище должно быть реализовано транзакционно по отношению к операциям, реализующим непосредственную вставку объектов в БД при импорте.
- Для реализации распределенной транзакции из пункта 2 разрешается использовать любые инструменты. Рекомендуется решать задачу при помощи собственной реализации двухфазного коммита на уровне бизнес-логики приложения.
- Необходимо на защите быть готовым продемонстрировать корректность реализованной распределенной транзакции в следующих условиях:
    - отказ файлового хранилища (БД продолжает работать)
    - отказ БД (файловое хранилище продолжает работать)
    - ошибка в бизнес-логике сервера (работают и БД, и файловое хранилище, однако в коде сервера вылетает RuntimeException между запросами в разные источники данных)
- Необходимо:
    - на защите быть готовым продемонстрировать корректность работы распределенной транзакции в условиях параллельных запросов от нескольких пользователей (реализованный в ЛР 2 сценарий для Apache JMeter, тестирующий функцию импорта, должен продолжать корректно отрабатывать)
    - в отчете привести примеры ситуаций, которые могут возникать при осуществлении параллельных запросов от нескольких пользователей в вашем приложении, и описать, как ваша реализация обрабатывает такие ситуации
- После окончания демонстрации лабораторной работы ваше приложение и все запущенные элементы окружения, необходимые для работы приложения, должны быть остановлены.

Содержание отчёта:

1. Текст задания.
2. UML-диаграммы классов и пакетов разработанного приложения.
3. Исходный код системы или ссылка на репозиторий с исходным кодом.
4. Выводы по работе.

Вопросы к защите лабораторной работы: 

1. Java Transaction API. Основные принципы и программные интерфейсы. Работа с JTA в приложениях на базе Spring.
2. Двухфазная фиксация в распределенных транзакциях (two-phase commit protocol).
3. Распределенные транзакции, спецификация XA. Реализация в приложениях на базе Jakarta EE и Spring.
4. Менеджеры транзакций. Использование менеджера транзакций в приложениях на базе Spring.

