# Лабораторная работа №1

## Условие

Цель работы - на выделенном узле создать и сконфигурировать новый кластер БД `Postgres`, саму БД, табличные пространства и новую роль, а также произвести наполнение базы в соответствии с заданием. Отчёт по работе должен содержать все команды по настройке, скрипты, а также измененные строки конфигурационных файлов.

Способ подключения к узлу из сети Интернет через `helios`:

```sh
ssh -J sXXXXXX@helios.cs.ifmo.ru:2222 postgresY@pgZZZ
```

Способ подключения к узлу из сети факультета:

```sh
ssh postgresY@pgZZZ
```

Номер выделенного узла `pgZZZ`, а также логин и пароль для подключения Вам выдаст преподаватель.

Этап 1. Инициализация кластера БД
- Директория кластера: `$HOME/zas34`
- Кодировка: `ANSI1251`
- Локаль: `русская`
- Параметры инициализации задать через аргументы команды

Этап 2. Конфигурация и запуск сервера БД

- Способы подключения:
    1) `Unix-domain` сокет в режиме `peer`;
    2) сокет `TCP/IP`, только `localhost`
- Номер порта: `9066`
- Способ аутентификации `TCP/IP` клиентов: `по паролю в открытом виде`
- Остальные способы подключений запретить.
- Настроить следующие параметры сервера БД:
    - `max_connections`
    - `shared_buffers`
    - `temp_buffers`
    - `work_mem`
    - `checkpoint_timeout`
    - `effective_cache_size`
    - `fsync`
    - `commit_delay`
 Параметры должны быть подобраны в соответствии со сценарием `OLTP`: 200 одновременных пользователей, 4 сессий на каждого; каждая сессия инициирует до 10 транзакций на запись размером 8КБ; обеспечить максимальную производительность.
- Директория `WAL` файлов: `$PGDATA/pg_wal`
- Формат лог-файлов: `.csv`
- Уровень сообщений лога: `ERROR`
- Дополнительно логировать: контрольные точки и попытки подключения

Этап 3. Дополнительные табличные пространства и наполнение базы

- Создать новое табличное пространство для индексов: `$HOME/grj79`
- На основе `template1` создать новую базу: `uglygraylaw`
- Создать новую роль, предоставить необходимые права, разрешить подключение к базе.
- От имени новой роли (не администратора) произвести наполнение ВСЕХ созданных баз тестовыми наборами данных. ВСЕ табличные пространства должны использоваться по назначению.
- Вывести список всех табличных пространств кластера и содержащиеся в них объекты.

## Выполнение

### Этап 1. Инициализация кластера БД

Установка переменных окружения:

```sh
export PGDATA="$HOME/zas34"
```

Создание директорий и инициализация кластера:

```sh
initdb -D "$PGDATA" -E=WIN1251 --locale=ru_RU.CP1251
```

Запускаем сервер баз данных:

```sh
pg_ctl -D "$PGDATA" -l "$PGDATA/server.log" start
```


## Вопросы для подготовки к защите

- Способы запуска и остановки сервера PosgreSQL, их отличия.
- Какие параметры локали сервера БД можно настроить? На что они влияют? Как и где их переопределить?
- Конфигурационные файлы сервера. Способы изменения и применения конфигурации.
- Что такое табличное пространство? Зачем нужны дополнительные табличные пространства?
- Зачем нужны template0 и template1?
