<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Лабораторная работа №3</title>
    <link rel="stylesheet" type="text/css" href="static/css/main.css" />
</h:head>
<h:body>
    <h:form id="mainForm">
        <div class="container">
            <!-- plot panel -->
            <div class="left-panel">
                <p:graphicImage id="plotImage" value="#{plotBean.image}" cache="false" style="max-width: 100%; height: auto;">
                    <p:ajax event="click" listener="#{plotBean.handleClick}" render="plotImage" />
                </p:graphicImage>
            </div>

            <!-- panel gap -->
            <div class="panel-gap"></div>

            <!-- right panel with input -->
            <div class="right-panel">
                <!-- X input -->
                <div class="form-field">
                    <h:outputLabel styleClass="label-x" value="Изменение X:" />
                    <div class="x-buttons">
                        <!-- Buttons for X selection -->
                        <h:commandButton id="xButton1" styleClass="change-x" value="-4">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(-4)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton2" styleClass="change-x" value="-3">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(-3)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton3" styleClass="change-x" value="-2">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(-2)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton4" styleClass="change-x" value="-1">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(-1)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton5" styleClass="change-x" value="0">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(0)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton6" styleClass="change-x" value="1">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(1)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton7" styleClass="change-x" value="2">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(2)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton8" styleClass="change-x" value="3">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(3)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                        <h:commandButton id="xButton9" styleClass="change-x" value="4">
                            <f:ajax execute="@this" render="plotImage" listener="#{plotBean.setX(4)}" />
                            <f:attribute name="onclick" value="setActiveButton(this)" />
                        </h:commandButton>
                    </div>
                </div>

                <!-- Y input -->
                <div class="form-field">
                    <h:outputLabel styleClass="label-y" for="yCoord" value="Изменение Y (-3...3):" />
                    <h:inputText styleClass="input-y" id="yCoord" value="#{plotBean.y}" size="5">
                        <f:validateDoubleRange minimum="-3" maximum="3" />
                        <f:ajax event="blur" render="plotImage" listener="#{plotBean.checkPoint}" />
                    </h:inputText>
                </div>

                <!-- Radius input -->
                <div class="form-field">
                    <h:outputLabel styleClass="label-r" for="radius" value="Изменение R (1...4):" />
                    <h:inputText styleClass="input-r" id="radius" value="#{plotBean.radius}" size="5">
                        <f:validateDoubleRange minimum="1" maximum="4" />
                        <f:ajax event="blur" render="plotImage" listener="#{plotBean.updateRadius}" />
                    </h:inputText>
                </div>

                <!-- Check Point Button -->
                <div class="form-field">
                    <h:commandButton id="checkButton" styleClass="check-point-button active" value="Проверить точку"
                                     action="#{plotBean.checkPoint}" update="plotImage" />
                </div>

                <!-- Back to Welcome Page Button -->
                <div class="form-field">
                    <h:commandButton value="Назад на стартовую страницу" action="welcome.xhtml" styleClass="back-button active" />
                </div>
            </div>
        </div>
    </h:form>

    <!-- Script to manage active buttons and handle Enter key -->
    <script>
        function setActiveButton(clickedButton) {
            const buttons = document.querySelectorAll('.change-x');
            buttons.forEach(button => {
                button.classList.remove('active');
            });
            clickedButton.classList.add('active');

            // saving active button id to localStorage
            localStorage.setItem('activeXButton', clickedButton.id);
        }

        // restore activeXButton from localStorage
        document.addEventListener('DOMContentLoaded', function () {
            const activeButtonId = localStorage.getItem('activeXButton');
            if (activeButtonId) {
                const activeButton = document.getElementById(activeButtonId);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
            }
        });

        // handle form with checkButton
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const checkButton = document.getElementById('mainForm:checkButton');
                if (checkButton) {
                    checkButton.click();
                }
            }
        });
    </script>
</h:body>
</html>
